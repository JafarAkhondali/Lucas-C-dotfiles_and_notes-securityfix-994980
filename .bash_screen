LAST_DIR_SCREEN_TMP_FILE=~/.screen-pwd.tmp

function s() { # New screen window in same dir
    screen -X chdir $PWD
    rm $LAST_DIR_SCREEN_TMP_FILE
    screen
}

function set_screen_title() {
    if [ -n "$STY" ] && [ "$@" != "prompt_command" ] ; then
        screen -X title "$@"
        [ "$PWD" != "$HOME" ] && pwd > $LAST_DIR_SCREEN_TMP_FILE
    fi
}

if [ $TERM != "screen" ]; then
    if ! ps -eo comm | grep -q '^screen'; then
        screen -d -m
    else
        screen -A -x
    fi
else
    # HACKED thanks to http://code-and-hacks.blogspot.com/2010/04/setting-terminal-title-in-gnu-screen.html
    # and http://www.davidpashley.com/articles/xterm-titles-with-bash.html
    trap 'set_screen_title "$BASH_COMMAND"' DEBUG
    [ -f $LAST_DIR_SCREEN_TMP_FILE ] && cd $(cat $LAST_DIR_SCREEN_TMP_FILE)
fi

# screen -ls
# screen -r
# DOC: http://www.bangmoney.org/presentations/screen.html
